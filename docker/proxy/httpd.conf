# Apache HTTP Server Configuration
# Generated by Docker Project Builder

ServerRoot "/usr/local/apache2"
ServerName writer.essensedesigns.com

Listen 80
Listen 443

# Load required modules
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule access_compat_module modules/mod_access_compat.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule reqtimeout_module modules/mod_reqtimeout.so
LoadModule filter_module modules/mod_filter.so
LoadModule mime_module modules/mod_mime.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule env_module modules/mod_env.so
LoadModule headers_module modules/mod_headers.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule version_module modules/mod_version.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule status_module modules/mod_status.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule dir_module modules/mod_dir.so
LoadModule alias_module modules/mod_alias.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule ssl_module modules/mod_ssl.so
LoadModule socache_shmcb_module modules/mod_socache_shmcb.so

<IfModule unixd_module>
    User daemon
    Group daemon
</IfModule>

# Server admin
ServerAdmin admin@writer.essensedesigns.com

# Document root (not used for proxying)
DocumentRoot "/usr/local/apache2/htdocs"

<Directory />
    AllowOverride none
    Require all denied
</Directory>

# Allow access to ACME challenge directory (for Let's Encrypt)
<Directory "/usr/local/apache2/htdocs/.well-known">
    Options None
    AllowOverride None
    Require all granted
</Directory>

# Error and access logs
ErrorLog /proc/self/fd/2
LogLevel warn

<IfModule log_config_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common
    CustomLog /proc/self/fd/1 common
</IfModule>

# Proxy settings
ProxyRequests Off
ProxyPreserveHost On

# Increase timeout for long-running requests (SSE streams, AI analysis)
# Default is 60s which is too short for brand voice analysis (2-5 min)
Timeout 600
ProxyTimeout 600

<Proxy *>
    Order deny,allow
    Allow from all
</Proxy>

# SSL Configuration (enabled when certificates are present)
<IfModule ssl_module>
    <IfFile "/usr/local/apache2/conf/ssl/writer.essensedesigns.com.crt">
        SSLCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES
        SSLProxyCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES
        SSLHonorCipherOrder on
        SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
        SSLProxyProtocol all -SSLv3 -TLSv1 -TLSv1.1
        SSLPassPhraseDialog  builtin
        SSLSessionCache "shmcb:/usr/local/apache2/logs/ssl_scache(512000)"
        SSLSessionCacheTimeout 300
    </IfFile>
</IfModule>

# Include vhosts
IncludeOptional conf/vhosts/*.conf
